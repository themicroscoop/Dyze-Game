<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DYZE - Creature Combat</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --accent-orange: #ff6b35;
            --accent-yellow: #f7c948;
            --accent-red: #e63946;
            --accent-green: #2ec4b6;
            --accent-blue: #4361ee;
            --text-light: #edf2f4;
            --text-muted: #8d99ae;
            --damage-1: #4ade80;
            --damage-2: #fbbf24;
            --damage-3: #ef4444;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: var(--bg-dark);
            background-image: 
                radial-gradient(ellipse at 20% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(67, 97, 238, 0.1) 0%, transparent 50%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Title Screen */
        .title-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .title-screen h1 {
            font-family: 'Bangers', cursive;
            font-size: 8rem;
            color: var(--accent-orange);
            text-shadow: 
                4px 4px 0 var(--accent-yellow),
                8px 8px 0 rgba(0,0,0,0.3);
            letter-spacing: 0.1em;
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .title-screen .subtitle {
            font-size: 1.5rem;
            color: var(--text-muted);
            margin-top: 10px;
            margin-bottom: 40px;
        }

        .btn {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-red));
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 107, 53, 0.5);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-light);
            border: 2px solid var(--accent-blue);
        }

        .btn-secondary:hover {
            background: var(--accent-blue);
        }

        /* Game Board */
        .game-board {
            display: none;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }

        .game-board.active {
            display: flex;
        }

        /* Player Areas */
        .player-area {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            border: 2px solid transparent;
        }

        .player-area.active-turn {
            border-color: var(--accent-yellow);
            box-shadow: 0 0 30px rgba(247, 201, 72, 0.2);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-name {
            font-family: 'Bangers', cursive;
            font-size: 1.8rem;
            color: var(--accent-yellow);
        }

        .player-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-icon {
            width: 20px;
            height: 20px;
        }

        /* Battle Zone */
        .battle-zone {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            padding: 30px;
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
            min-height: 350px;
            position: relative;
        }

        .vs-badge {
            position: absolute;
            font-family: 'Bangers', cursive;
            font-size: 3rem;
            color: var(--accent-red);
            text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
            z-index: 10;
        }

        /* Creature Card */
        .creature-card {
            width: 220px;
            background: linear-gradient(145deg, #2a2a4a, #1a1a2e);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid var(--accent-blue);
            position: relative;
            transition: all 0.3s ease;
        }

        .creature-card.player1 {
            border-color: var(--accent-orange);
        }

        .creature-card.player2 {
            border-color: var(--accent-blue);
        }

        .creature-card.taking-damage {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-2deg); }
            40% { transform: translateX(10px) rotate(2deg); }
            60% { transform: translateX(-10px) rotate(-2deg); }
            80% { transform: translateX(10px) rotate(2deg); }
        }

        .creature-card.eliminated {
            opacity: 0.4;
            filter: grayscale(1);
        }

        .card-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 5px;
        }

        .creature-name {
            font-family: 'Bangers', cursive;
            font-size: 1.3rem;
            color: var(--text-light);
            text-transform: uppercase;
        }

        .defense-row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .defense-pips {
            display: flex;
            gap: 4px;
        }

        .pip {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid var(--accent-orange);
            background: var(--accent-orange);
        }

        .pip.damaged {
            background: var(--accent-red);
            border-color: var(--accent-red);
        }

        .pip.empty {
            background: transparent;
        }

        .level-badge {
            background: var(--accent-orange);
            color: white;
            font-family: 'Bangers', cursive;
            font-weight: 400;
            font-size: 1.1rem;
            padding: 2px 10px;
            border-radius: 6px;
            margin-right: 10px;
            letter-spacing: 0.05em;
        }

        .creature-art {
            width: 100%;
            height: 140px;
            background: linear-gradient(135deg, #3a3a5a, #2a2a4a);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .attack-grid {
            display: flex;
            flex-direction: column;
            gap: 5px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
        }

        .attack-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .damage-label {
            font-weight: 700;
            width: 20px;
            text-align: center;
        }

        .damage-label.dmg-1 { color: var(--damage-1); }
        .damage-label.dmg-2 { color: var(--damage-2); }
        .damage-label.dmg-3 { color: var(--damage-3); }

        .dice-results {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .die-pip {
            width: 24px;
            height: 24px;
            background: var(--bg-dark);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .die-pip.hit {
            background: var(--accent-green);
            color: var(--bg-dark);
        }

        /* Roll Phase */
        .roll-phase {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 40px;
            background: var(--bg-card);
            border-radius: 20px;
            margin: 20px 0;
        }

        .roll-phase.active {
            display: flex;
        }

        .roll-phase h2 {
            font-family: 'Bangers', cursive;
            font-size: 2.5rem;
            color: var(--accent-yellow);
        }

        .roll-instruction {
            font-size: 1.1rem;
            color: var(--text-muted);
        }

        /* RGB Die */
        .rgb-die {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            animation: diceRoll 0.5s ease-out;
        }

        .rgb-die.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .rgb-die.green {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .rgb-die.blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .dice-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .dice-separator {
            font-size: 1.5rem;
            color: var(--text-muted);
        }

        /* Roll Results */
        .roll-results {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 20px;
            margin: 20px 0;
        }

        .roll-results.active {
            display: flex;
        }

        .roll-results h2 {
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: var(--accent-yellow);
        }

        .results-display {
            display: flex;
            justify-content: center;
            gap: 80px;
            width: 100%;
        }

        .player-result {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .player-result h3 {
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .rolled-dice {
            display: flex;
            gap: 10px;
        }

        .rolled-die {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--bg-dark);
            animation: diceRoll 0.5s ease-out;
        }

        .rolled-die.hit {
            background: var(--accent-green);
            color: var(--bg-dark);
        }

        .rolled-die.self-damage {
            background: var(--accent-red);
            color: white;
        }

        .rolled-die.miss {
            background: #666;
            color: white;
        }

        .self-damage-text {
            color: var(--accent-red);
            font-weight: 600;
        }

        @keyframes diceRoll {
            0% { transform: rotateZ(0deg) scale(0.5); opacity: 0; }
            50% { transform: rotateZ(180deg) scale(1.2); }
            100% { transform: rotateZ(360deg) scale(1); opacity: 1; }
        }

        .damage-summary {
            font-size: 1.1rem;
            text-align: center;
        }

        .damage-dealt {
            color: var(--accent-green);
            font-weight: 600;
        }

        .self-damage-text {
            color: var(--accent-red);
            font-weight: 600;
        }

        /* Transition Screen */
        .transition-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .transition-screen.active {
            display: flex;
        }

        .transition-screen h2 {
            font-family: 'Bangers', cursive;
            font-size: 3rem;
            color: var(--accent-yellow);
            margin-bottom: 20px;
        }

        .transition-screen p {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        /* Round Result */
        .round-result {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 40px;
            background: var(--bg-card);
            border-radius: 20px;
            margin: 20px 0;
            border: 3px solid var(--accent-yellow);
        }

        .round-result.active {
            display: flex;
        }

        .round-result h2 {
            font-family: 'Bangers', cursive;
            font-size: 2.5rem;
            color: var(--accent-yellow);
        }

        .round-result .outcome {
            font-size: 1.4rem;
            color: var(--text-light);
            text-align: center;
            line-height: 1.6;
        }

        .round-result .creature-fate {
            display: flex;
            gap: 40px;
            margin: 20px 0;
        }

        .fate-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: var(--bg-dark);
            border-radius: 15px;
            min-width: 150px;
        }

        .fate-card .emoji {
            font-size: 3rem;
        }

        .fate-card .name {
            font-weight: 600;
            color: var(--text-light);
        }

        .fate-card .status {
            font-size: 0.9rem;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .fate-card .status.eliminated {
            background: var(--accent-red);
            color: white;
        }

        .fate-card .status.survived {
            background: var(--accent-green);
            color: var(--bg-dark);
        }

        /* Game Over */
        .game-over {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .game-over.active {
            display: flex;
        }

        .game-over h1 {
            font-family: 'Bangers', cursive;
            font-size: 4rem;
            color: var(--accent-yellow);
            margin-bottom: 10px;
        }

        .game-over .winner {
            font-size: 2rem;
            color: var(--accent-orange);
            margin-bottom: 30px;
        }

        /* Card Selection */
        .card-selection {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 20px;
            margin: 20px 0;
        }

        .card-selection.active {
            display: flex;
        }

        .card-selection h2 {
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: var(--accent-yellow);
        }

        .card-choices {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .card-choice {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid transparent;
            border-radius: 18px;
        }

        .card-choice:hover {
            transform: translateY(-8px);
            border-color: var(--accent-yellow);
        }

        .card-choice.selected {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(46, 196, 182, 0.4);
        }

        .card-choice .creature-card {
            margin: 0;
        }

        /* Hand Display */
        .hand-section {
            margin-top: 15px;
        }

        .hand-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .hand-cards {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .hand-card {
            background: var(--bg-dark);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            border: 2px solid var(--accent-blue);
        }

        .hand-card.player1 {
            border-color: var(--accent-orange);
        }

        /* Hidden class for hot seat */
        .hidden-choice {
            filter: blur(10px);
            user-select: none;
            pointer-events: none;
        }

        /* Round info */
        .round-info {
            text-align: center;
            padding: 10px;
            font-size: 1.1rem;
            color: var(--text-muted);
        }

        .round-number {
            font-family: 'Bangers', cursive;
            font-size: 1.5rem;
            color: var(--accent-yellow);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Title Screen -->
        <div class="title-screen" id="titleScreen">
            <h1>DYZE</h1>
            <p class="subtitle">Creature Combat Card Game</p>
            <button class="btn btn-primary" onclick="startGame()">Start Game</button>
        </div>

        <!-- Main Game Board -->
        <div class="game-board" id="gameBoard">
            <!-- Round Info -->
            <div class="round-info">
                <span class="round-number">Round <span id="roundNumber">1</span></span>
            </div>

            <!-- Player 2 Area (Top) -->
            <div class="player-area" id="player2Area">
                <div class="player-header">
                    <span class="player-name">Player 2</span>
                    <div class="player-stats">
                        <span class="stat">üé¥ Stack: <span id="p2Stack">0</span></span>
                        <span class="stat">üè† Holding: <span id="p2Holding">0</span></span>
                        <span class="stat">üíÄ Grave: <span id="p2Grave">0</span></span>
                    </div>
                </div>
                <div class="hand-section">
                    <div class="hand-label">Hand:</div>
                    <div class="hand-cards" id="p2Hand"></div>
                </div>
            </div>

            <!-- Battle Zone -->
            <div class="battle-zone">
                <div id="p1BattleCard"></div>
                <span class="vs-badge">VS</span>
                <div id="p2BattleCard"></div>
            </div>

            <!-- Player 1 Area (Bottom) -->
            <div class="player-area" id="player1Area">
                <div class="player-header">
                    <span class="player-name">Player 1</span>
                    <div class="player-stats">
                        <span class="stat">üé¥ Stack: <span id="p1Stack">0</span></span>
                        <span class="stat">üè† Holding: <span id="p1Holding">0</span></span>
                        <span class="stat">üíÄ Grave: <span id="p1Grave">0</span></span>
                    </div>
                </div>
                <div class="hand-section">
                    <div class="hand-label">Hand:</div>
                    <div class="hand-cards" id="p1Hand"></div>
                </div>
            </div>

            <!-- Card Selection -->
            <div class="card-selection" id="cardSelection">
                <h2 id="cardSelectPrompt">Player 1 - Choose Your Creature</h2>
                <div class="card-choices" id="cardChoices">
                    <!-- Filled dynamically -->
                </div>
                <button class="btn btn-primary" id="confirmCardBtn" onclick="confirmCard()" style="display:none;">Send Into Battle!</button>
            </div>

            <!-- Card Selection Transition -->
            <div class="transition-screen" id="cardTransitionScreen">
                <h2 id="cardTransitionTitle">Pass to Player 2</h2>
                <p id="cardTransitionText">Player 1 has chosen their creature.</p>
                <button class="btn btn-primary" onclick="continueToNextCardSelect()">Ready</button>
            </div>

            <!-- Roll Phase -->
            <div class="roll-phase" id="rollPhase">
                <h2>Time to Roll!</h2>
                <p class="roll-instruction">Both players roll their RGB die + 2 attack dice</p>
                <button class="btn btn-primary" onclick="executeRolls()">Roll the Dice!</button>
            </div>

            <!-- Roll Results -->
            <div class="roll-results" id="rollResults">
                <h2>Battle Results!</h2>
                <div class="results-display">
                    <div class="player-result">
                        <h3>Player 1</h3>
                        <div class="rolled-dice" id="p1Dice"></div>
                        <div class="damage-summary" id="p1Summary"></div>
                    </div>
                    <div class="player-result">
                        <h3>Player 2</h3>
                        <div class="rolled-dice" id="p2Dice"></div>
                        <div class="damage-summary" id="p2Summary"></div>
                    </div>
                </div>
                <button class="btn btn-primary" id="continueBtn" onclick="continueGame()">Continue</button>
            </div>

            <!-- Round Result -->
            <div class="round-result" id="roundResult">
                <h2 id="roundResultTitle">Round Over!</h2>
                <div class="creature-fate" id="creatureFates"></div>
                <p class="outcome" id="roundOutcome"></p>
                <button class="btn btn-primary" onclick="proceedAfterRound()">Next Round</button>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over" id="gameOver">
            <h1>Game Over!</h1>
            <p class="winner" id="winnerText">Player 1 Wins!</p>
            <button class="btn btn-primary" onclick="location.reload()">Play Again</button>
        </div>
    </div>

    <script>
        // Creature Database - Rebalanced to prevent double KOs
        // Low levels: strong chip (1dmg), weak/no burst (3dmg)
        // High levels: no chip (1dmg), strong burst (3dmg)
        // Level = Defense = Point Cost
        const creatures = [
            // Level 1 (Defense 1) - 3 in 1dmg, 1 in 2dmg, 0 in 3dmg
            { name: "Mosqui-toe", level: 1, defense: 1, attacks: { 1: [1,3,5], 2: [2], 3: [] }, emoji: "ü¶ü" },
            { name: "Fumble-bee", level: 1, defense: 1, attacks: { 1: [2,4,6], 2: [1], 3: [] }, emoji: "üêù" },
            { name: "Score-pion", level: 1, defense: 1, attacks: { 1: [1,2,5], 2: [3], 3: [] }, emoji: "ü¶Ç" },
            { name: "Fire Ants", level: 1, defense: 1, attacks: { 1: [2,3,4], 2: [6], 3: [] }, emoji: "üêú" },
            { name: "Scentipede", level: 1, defense: 1, attacks: { 1: [1,4,6], 2: [5], 3: [] }, emoji: "ü¶®" },
            
            // Level 2 (Defense 2) - 2 in 1dmg, 2 in 2dmg, 0 in 3dmg
            { name: "Doctopus", level: 2, defense: 2, attacks: { 1: [3,4], 2: [1,5], 3: [] }, emoji: "üêô" },
            { name: "Croak", level: 2, defense: 2, attacks: { 1: [3,6], 2: [1,4], 3: [] }, emoji: "üê∏" },
            { name: "Hot Rock", level: 2, defense: 2, attacks: { 1: [3,6], 2: [2,5], 3: [] }, emoji: "ü¶é" },
            { name: "Peli-cant", level: 2, defense: 2, attacks: { 1: [2,5], 2: [1,4], 3: [] }, emoji: "üê¶" },
            { name: "Mon-goose", level: 2, defense: 2, attacks: { 1: [1,5], 2: [2,6], 3: [] }, emoji: "‚úàÔ∏è" },
            
            // Level 3 (Defense 3) - 2 in 1dmg, 2 in 2dmg, 1 in 3dmg
            { name: "Deerdevil", level: 3, defense: 3, attacks: { 1: [1,4], 2: [2,5], 3: [3] }, emoji: "ü¶å" },
            { name: "Slapping Turtle", level: 3, defense: 3, attacks: { 1: [1,4], 2: [3,6], 3: [5] }, emoji: "üê¢" },
            { name: "Honey Badger", level: 3, defense: 3, attacks: { 1: [4,6], 2: [1,3], 3: [2] }, emoji: "ü¶°" },
            { name: "Legal Eagle", level: 3, defense: 3, attacks: { 1: [1,6], 2: [2,5], 3: [3] }, emoji: "ü¶Ö" },
            { name: "Con-dor", level: 3, defense: 3, attacks: { 1: [3,6], 2: [1,4], 3: [2] }, emoji: "ü¶§" },
            
            // Level 4 (Defense 4) - 1 in 1dmg, 2 in 2dmg, 2 in 3dmg
            { name: "StareBear", level: 4, defense: 4, attacks: { 1: [3], 2: [1,6], 3: [2,4] }, emoji: "üêª" },
            { name: "DareWolf", level: 4, defense: 4, attacks: { 1: [2], 2: [4,5], 3: [1,6] }, emoji: "üê∫" },
            { name: "Orca-stra", level: 4, defense: 4, attacks: { 1: [2], 2: [1,6], 3: [3,4] }, emoji: "üêã" },
            { name: "Komono Dragon", level: 4, defense: 4, attacks: { 1: [6], 2: [2,5], 3: [1,3] }, emoji: "üêâ" },
            
            // Level 5 (Defense 5) - 0 in 1dmg, 2 in 2dmg, 2 in 3dmg
            { name: "DrizzlyBear", level: 5, defense: 5, attacks: { 1: [], 2: [3,4], 3: [1,5] }, emoji: "üåßÔ∏è" },
            { name: "Chummy", level: 5, defense: 5, attacks: { 1: [], 2: [4,5], 3: [2,3] }, emoji: "ü¶à" },
            { name: "Refrig-agator", level: 5, defense: 5, attacks: { 1: [], 2: [3,6], 3: [2,4] }, emoji: "üêä" },
        ];

        // Game State
        let gameState = {
            round: 1,
            currentPlayer: 1,
            phase: 'select', // select, transition, roll, resolve
            player1: {
                stack: [],
                hand: [],
                holdingCell: [],
                graveyard: [],
                activeCreature: null,
                activeDamage: 0,
                diceChoice: 0
            },
            player2: {
                stack: [],
                hand: [],
                holdingCell: [],
                graveyard: [],
                activeCreature: null,
                activeDamage: 0,
                diceChoice: 0
            }
        };

        // Build preset decks (50 points each)
        function buildPresetDeck() {
            // Deck: Mix of creatures totaling ~50 points
            // 10x Level 1 (10pts) + 5x Level 2 (10pts) + 5x Level 3 (15pts) + 3x Level 4 (12pts) + 1x Level 5 (5pts) = 52pts close enough
            let deck = [];
            
            // Add level 1s
            for (let i = 0; i < 10; i++) {
                deck.push({...creatures[i % 5]});
            }
            // Add level 2s
            for (let i = 0; i < 5; i++) {
                deck.push({...creatures[5 + (i % 5)]});
            }
            // Add level 3s
            for (let i = 0; i < 5; i++) {
                deck.push({...creatures[10 + (i % 5)]});
            }
            // Add level 4s
            for (let i = 0; i < 3; i++) {
                deck.push({...creatures[15 + (i % 4)]});
            }
            // Add level 5
            deck.push({...creatures[19]});
            
            // Shuffle
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            return deck;
        }

        function startGame() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('gameBoard').classList.add('active');
            
            // Initialize decks
            gameState.player1.stack = buildPresetDeck();
            gameState.player2.stack = buildPresetDeck();
            
            // Draw initial hands
            for (let i = 0; i < 3; i++) {
                if (gameState.player1.stack.length > 0) {
                    gameState.player1.hand.push(gameState.player1.stack.pop());
                }
                if (gameState.player2.stack.length > 0) {
                    gameState.player2.hand.push(gameState.player2.stack.pop());
                }
            }
            
            // No active creatures yet - players will choose
            gameState.player1.activeCreature = null;
            gameState.player2.activeCreature = null;
            
            updateDisplay();
            showCardSelection(1);
        }

        function updateDisplay() {
            // Update stats
            document.getElementById('p1Stack').textContent = gameState.player1.stack.length;
            document.getElementById('p1Holding').textContent = gameState.player1.holdingCell.length;
            document.getElementById('p1Grave').textContent = gameState.player1.graveyard.length;
            
            document.getElementById('p2Stack').textContent = gameState.player2.stack.length;
            document.getElementById('p2Holding').textContent = gameState.player2.holdingCell.length;
            document.getElementById('p2Grave').textContent = gameState.player2.graveyard.length;
            
            document.getElementById('roundNumber').textContent = gameState.round;
            
            // Update hands
            updateHandDisplay('p1Hand', gameState.player1.hand, 'player1');
            updateHandDisplay('p2Hand', gameState.player2.hand, 'player2');
            
            // Update battle cards
            renderBattleCard('p1BattleCard', gameState.player1.activeCreature, gameState.player1.activeDamage, 'player1');
            renderBattleCard('p2BattleCard', gameState.player2.activeCreature, gameState.player2.activeDamage, 'player2');
        }

        function updateHandDisplay(elementId, hand, playerClass) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            hand.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = `hand-card ${playerClass}`;
                const levelText = card.level ? `[${card.level}] ` : '';
                cardEl.textContent = `${card.emoji} ${levelText}${card.name}`;
                container.appendChild(cardEl);
            });
        }

        function renderBattleCard(containerId, creature, damage, playerClass) {
            const container = document.getElementById(containerId);
            if (!creature) {
                container.innerHTML = '<div class="creature-card empty">No Creature</div>';
                return;
            }
            
            // Show pips based on creature's actual defense value
            let pipsHtml = '';
            for (let i = 0; i < creature.defense; i++) {
                if (i < damage) {
                    pipsHtml += '<div class="pip damaged"></div>';
                } else {
                    pipsHtml += '<div class="pip"></div>';
                }
            }
            
            const attackGridHtml = [1, 2, 3].map(dmg => {
                const dice = creature.attacks[dmg];
                const diceHtml = dice.length > 0 
                    ? dice.map(d => `<div class="die-pip">${d}</div>`).join('')
                    : '<div class="die-pip">-</div>';
                return `
                    <div class="attack-row">
                        <span class="damage-label dmg-${dmg}">${dmg}</span>
                        <div class="dice-results">${diceHtml}</div>
                    </div>
                `;
            }).join('');
            
            const levelBadge = creature.level ? `<span class="level-badge">${creature.level}</span>` : '';
            
            container.innerHTML = `
                <div class="creature-card ${playerClass}" id="${containerId}Card">
                    <div class="card-header">
                        <span class="creature-name">${levelBadge}${creature.name}</span>
                    </div>
                    <div class="defense-row">
                        <div class="defense-pips">${pipsHtml}</div>
                    </div>
                    <div class="creature-art">${creature.emoji}</div>
                    <div class="attack-grid">${attackGridHtml}</div>
                </div>
            `;
        }

        let selectedCardIndex = -1;

        function showCardSelection(player) {
            gameState.currentPlayer = player;
            gameState.phase = 'cardSelect';
            selectedCardIndex = -1;
            
            const playerState = player === 1 ? gameState.player1 : gameState.player2;
            
            document.getElementById('cardSelection').classList.add('active');
            document.getElementById('cardTransitionScreen').classList.remove('active');
            document.getElementById('rollPhase')?.classList.remove('active');
            document.getElementById('rollResults').classList.remove('active');
            document.getElementById('roundResult').classList.remove('active');
            
            document.getElementById('cardSelectPrompt').textContent = `Player ${player} - Choose Your Creature`;
            document.getElementById('confirmCardBtn').style.display = 'none';
            
            // Highlight active player
            document.getElementById('player1Area').classList.toggle('active-turn', player === 1);
            document.getElementById('player2Area').classList.toggle('active-turn', player === 2);
            
            // Render card choices
            renderCardChoices(playerState.hand, player);
        }

        function renderCardChoices(hand, player) {
            const container = document.getElementById('cardChoices');
            container.innerHTML = '';
            
            hand.forEach((creature, index) => {
                // Build mini card HTML
                const attackGridHtml = [1, 2, 3].map(dmg => {
                    const dice = creature.attacks[dmg];
                    const diceHtml = dice.length > 0 
                        ? dice.map(d => `<div class="die-pip">${d}</div>`).join('')
                        : '<div class="die-pip">-</div>';
                    return `
                        <div class="attack-row">
                            <span class="damage-label dmg-${dmg}">${dmg}</span>
                            <div class="dice-results">${diceHtml}</div>
                        </div>
                    `;
                }).join('');
                
                // Show pips based on creature's actual defense
                let pipsHtml = '';
                for (let i = 0; i < creature.defense; i++) {
                    pipsHtml += '<div class="pip"></div>';
                }
                
                const levelBadge = creature.level ? `<span class="level-badge">${creature.level}</span>` : '';
                const playerClass = player === 1 ? 'player1' : 'player2';
                
                const cardHtml = `
                    <div class="card-choice" onclick="selectCard(${index})" id="cardChoice${index}">
                        <div class="creature-card ${playerClass}">
                            <div class="card-header">
                                <span class="creature-name">${levelBadge}${creature.name}</span>
                            </div>
                            <div class="defense-row">
                                <div class="defense-pips">${pipsHtml}</div>
                            </div>
                            <div class="creature-art">${creature.emoji}</div>
                            <div class="attack-grid">${attackGridHtml}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }

        function selectCard(index) {
            selectedCardIndex = index;
            document.querySelectorAll('.card-choice').forEach(el => el.classList.remove('selected'));
            document.getElementById(`cardChoice${index}`).classList.add('selected');
            document.getElementById('confirmCardBtn').style.display = 'block';
        }

        function confirmCard() {
            if (selectedCardIndex < 0) return;
            
            const playerState = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            
            // Move selected card to active
            playerState.activeCreature = playerState.hand.splice(selectedCardIndex, 1)[0];
            playerState.activeDamage = 0;
            
            if (gameState.currentPlayer === 1) {
                // Show transition to player 2
                document.getElementById('cardSelection').classList.remove('active');
                document.getElementById('cardTransitionScreen').classList.add('active');
                document.getElementById('cardTransitionTitle').textContent = 'Pass to Player 2';
                document.getElementById('cardTransitionText').textContent = 'Player 1 has chosen their creature. Hand the device to Player 2.';
            } else {
                // Both have chosen, show roll phase
                document.getElementById('cardSelection').classList.remove('active');
                updateDisplay();
                showRollPhase();
            }
        }

        function continueToNextCardSelect() {
            document.getElementById('cardTransitionScreen').classList.remove('active');
            updateDisplay();
            showCardSelection(2);
        }

        function showRollPhase() {
            document.getElementById('rollPhase').classList.add('active');
            document.getElementById('rollResults').classList.remove('active');
            document.getElementById('roundResult').classList.remove('active');
            
            // Remove active turn highlights - both are rolling
            document.getElementById('player1Area').classList.remove('active-turn');
            document.getElementById('player2Area').classList.remove('active-turn');
        }

        function rollRGBDie() {
            // 2 red, 2 green, 2 blue (1/3 chance each)
            const roll = Math.floor(Math.random() * 6);
            if (roll < 2) return { color: 'blue', damage: 1, label: '1 DMG' };
            if (roll < 4) return { color: 'green', damage: 2, label: '2 DMG' };
            return { color: 'red', damage: 3, label: '3 DMG' };
        }

        function executeRolls() {
            document.getElementById('rollPhase').classList.remove('active');
            
            // Roll RGB die for each player
            const p1RGB = rollRGBDie();
            const p2RGB = rollRGBDie();
            
            // Roll 2 six-sided dice for each player
            const p1Rolls = [
                Math.floor(Math.random() * 6) + 1,
                Math.floor(Math.random() * 6) + 1
            ];
            const p2Rolls = [
                Math.floor(Math.random() * 6) + 1,
                Math.floor(Math.random() * 6) + 1
            ];
            
            // Get creatures
            const p1Creature = gameState.player1.activeCreature;
            const p2Creature = gameState.player2.activeCreature;
            
            // Calculate hits based on RGB die result
            const p1Row = p1RGB.damage;
            const p2Row = p2RGB.damage;
            
            const p1HitRolls = [];
            let p1AttackDamage = 0;
            
            p1Rolls.forEach((roll, index) => {
                if (p1Creature.attacks[p1Row].includes(roll)) {
                    p1HitRolls.push(index);
                    p1AttackDamage += p1Row;
                }
            });
            
            const p2HitRolls = [];
            let p2AttackDamage = 0;
            
            p2Rolls.forEach((roll, index) => {
                if (p2Creature.attacks[p2Row].includes(roll)) {
                    p2HitRolls.push(index);
                    p2AttackDamage += p2Row;
                }
            });
            
            // Display results
            document.getElementById('rollResults').classList.add('active');
            
            // Show P1 dice (RGB + 3 attack dice)
            const p1DiceHtml = `
                <div class="dice-group">
                    <div class="rgb-die ${p1RGB.color}">${p1RGB.label}</div>
                    <span class="dice-separator">+</span>
                    ${p1Rolls.map((roll, idx) => {
                        const isHit = p1HitRolls.includes(idx);
                        return `<div class="rolled-die ${isHit ? 'hit' : 'miss'}">${roll}</div>`;
                    }).join('')}
                </div>
            `;
            document.getElementById('p1Dice').innerHTML = p1DiceHtml;
            
            // Show P2 dice
            const p2DiceHtml = `
                <div class="dice-group">
                    <div class="rgb-die ${p2RGB.color}">${p2RGB.label}</div>
                    <span class="dice-separator">+</span>
                    ${p2Rolls.map((roll, idx) => {
                        const isHit = p2HitRolls.includes(idx);
                        return `<div class="rolled-die ${isHit ? 'hit' : 'miss'}">${roll}</div>`;
                    }).join('')}
                </div>
            `;
            document.getElementById('p2Dice').innerHTML = p2DiceHtml;
            
            // Show summaries
            const p1HitNumbers = p1Creature.attacks[p1Row].length > 0 ? p1Creature.attacks[p1Row].join(', ') : 'none';
            let p1Summary = `<span>Row: <strong class="dmg-${p1Row}">${p1Row} damage</strong> (hits on: ${p1HitNumbers})</span><br>`;
            p1Summary += `<span class="damage-dealt">${p1HitRolls.length} hit${p1HitRolls.length !== 1 ? 's' : ''} ‚Üí ${p1AttackDamage} damage</span>`;
            document.getElementById('p1Summary').innerHTML = p1Summary;
            
            const p2HitNumbers = p2Creature.attacks[p2Row].length > 0 ? p2Creature.attacks[p2Row].join(', ') : 'none';
            let p2Summary = `<span>Row: <strong class="dmg-${p2Row}">${p2Row} damage</strong> (hits on: ${p2HitNumbers})</span><br>`;
            p2Summary += `<span class="damage-dealt">${p2HitRolls.length} hit${p2HitRolls.length !== 1 ? 's' : ''} ‚Üí ${p2AttackDamage} damage</span>`;
            document.getElementById('p2Summary').innerHTML = p2Summary;
            
            // Store results (no self-damage anymore)
            gameState.pendingResults = {
                p1Attack: p1AttackDamage,
                p2Attack: p2AttackDamage,
                p1Self: 0,
                p2Self: 0
            };
            
            // Animate damage on cards
            setTimeout(() => {
                if (p2AttackDamage > 0) {
                    document.getElementById('p1BattleCardCard')?.classList.add('taking-damage');
                }
                if (p1AttackDamage > 0) {
                    document.getElementById('p2BattleCardCard')?.classList.add('taking-damage');
                }
            }, 600);
        }

        function continueGame() {
            const results = gameState.pendingResults;
            
            // Apply damage (P1 takes P2's attack, P2 takes P1's attack)
            gameState.player1.activeDamage += results.p2Attack;
            gameState.player2.activeDamage += results.p1Attack;
            
            // Check for eliminations
            const p1Eliminated = gameState.player1.activeDamage >= gameState.player1.activeCreature.defense;
            const p2Eliminated = gameState.player2.activeDamage >= gameState.player2.activeCreature.defense;
            
            document.getElementById('rollResults').classList.remove('active');
            
            // Update display to show final damage state
            updateDisplay();
            
            if (p1Eliminated || p2Eliminated) {
                showRoundResult(p1Eliminated, p2Eliminated);
            } else {
                // Continue combat - roll again
                showRollPhase();
            }
        }

        function showRoundResult(p1Eliminated, p2Eliminated) {
            // Store creatures before they're moved
            const p1Creature = gameState.player1.activeCreature;
            const p2Creature = gameState.player2.activeCreature;
            
            // Store elimination state for later processing
            gameState.pendingEliminations = { p1Eliminated, p2Eliminated };
            
            // Build the result display
            let title = '';
            let outcome = '';
            
            if (p1Eliminated && p2Eliminated) {
                title = 'üí• Double KO! üí•';
                outcome = 'Both creatures have been eliminated! They go to their respective graveyards.';
            } else if (p1Eliminated) {
                title = 'üèÜ Player 2 Wins the Round!';
                outcome = `${p2Creature.name} survives and goes to the Holding Cell!<br>${p1Creature.name} is eliminated and goes to the Graveyard.`;
            } else if (p2Eliminated) {
                title = 'üèÜ Player 1 Wins the Round!';
                outcome = `${p1Creature.name} survives and goes to the Holding Cell!<br>${p2Creature.name} is eliminated and goes to the Graveyard.`;
            }
            
            document.getElementById('roundResultTitle').textContent = title;
            document.getElementById('roundOutcome').innerHTML = outcome;
            
            // Show creature fates
            const fatesHtml = `
                <div class="fate-card">
                    <span class="emoji">${p1Creature.emoji}</span>
                    <span class="name">${p1Creature.name}</span>
                    <span class="status ${p1Eliminated ? 'eliminated' : 'survived'}">${p1Eliminated ? 'üíÄ Eliminated' : '‚úì Survived'}</span>
                </div>
                <div class="fate-card">
                    <span class="emoji">${p2Creature.emoji}</span>
                    <span class="name">${p2Creature.name}</span>
                    <span class="status ${p2Eliminated ? 'eliminated' : 'survived'}">${p2Eliminated ? 'üíÄ Eliminated' : '‚úì Survived'}</span>
                </div>
            `;
            document.getElementById('creatureFates').innerHTML = fatesHtml;
            
            document.getElementById('roundResult').classList.add('active');
        }

        function proceedAfterRound() {
            const { p1Eliminated, p2Eliminated } = gameState.pendingEliminations;
            
            document.getElementById('roundResult').classList.remove('active');
            
            resolveEliminations(p1Eliminated, p2Eliminated);
        }

        function resolveEliminations(p1Eliminated, p2Eliminated) {
            if (p1Eliminated) {
                gameState.player1.graveyard.push(gameState.player1.activeCreature);
                gameState.player1.activeCreature = null;
                gameState.player1.activeDamage = 0;
            } else {
                // Survivor goes to holding cell
                gameState.player1.holdingCell.push(gameState.player1.activeCreature);
                gameState.player1.activeCreature = null;
                gameState.player1.activeDamage = 0;
            }
            
            if (p2Eliminated) {
                gameState.player2.graveyard.push(gameState.player2.activeCreature);
                gameState.player2.activeCreature = null;
                gameState.player2.activeDamage = 0;
            } else {
                gameState.player2.holdingCell.push(gameState.player2.activeCreature);
                gameState.player2.activeCreature = null;
                gameState.player2.activeDamage = 0;
            }
            
            // Draw cards for both players
            drawNewCreature(1);
            drawNewCreature(2);
            
            // Check for game over
            const p1CanPlay = canPlayerContinue(gameState.player1);
            const p2CanPlay = canPlayerContinue(gameState.player2);
            
            if (!p1CanPlay && !p2CanPlay) {
                endGame('Draw!');
                return;
            } else if (!p1CanPlay) {
                endGame('Player 2 Wins!');
                return;
            } else if (!p2CanPlay) {
                endGame('Player 1 Wins!');
                return;
            }
            
            gameState.round++;
            updateDisplay();
            
            // Start card selection for new round
            showCardSelection(1);
        }

        function canPlayerContinue(player) {
            return player.hand.length > 0 || player.stack.length > 0 || player.holdingCell.length > 0;
        }

        function drawNewCreature(player) {
            const playerState = player === 1 ? gameState.player1 : gameState.player2;
            
            // If hand is empty and stack is empty, shuffle holding cell back
            if (playerState.hand.length === 0 && playerState.stack.length === 0 && playerState.holdingCell.length > 0) {
                playerState.stack = [...playerState.holdingCell];
                playerState.holdingCell = [];
                // Shuffle
                for (let i = playerState.stack.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [playerState.stack[i], playerState.stack[j]] = [playerState.stack[j], playerState.stack[i]];
                }
            }
            
            // Draw to hand if needed
            while (playerState.hand.length < 3 && playerState.stack.length > 0) {
                playerState.hand.push(playerState.stack.pop());
            }
            
            // Don't auto-play - we'll use card selection
        }

        function endGame(result) {
            document.getElementById('gameBoard').classList.remove('active');
            document.getElementById('gameOver').classList.add('active');
            document.getElementById('winnerText').textContent = result;
        }
    </script>
</body>
</html>
